(function(b){var k=function(a){d("list",{scope:/all=1/.test(location.search)?"all":"my"}).then(function(a){var c=[];b("#showcases").html(a.reverse().map(function(a){c.push(d("status",{repo:a.repo,ref:a.branch}));return['<a target="_blank" href="https://git.trapti.tech/'+a.repo+'"><i class="fa fa-code-fork"></i> '+a.repo,'<a target="_blank" href="https://git.trapti.tech/'+a.repo+"/src/"+a.branch+'">'+a.branch,a.config.type,'<span id="status_'+a._id+'"><i class="fa fa-spinner fa-spin"></i></span>',
"static"==a.config.type?"-":a.config.image,h(a.config.expose),"static"==a.config.type||a.config.http_proxy?'<a target="_blank" href="http://'+g(a)+'"><i class="fa fa-external-link"></i> Open</a>':"-",'<a id="detail_'+a._id+'" href="javascript:"><i class="fa fa-chevron-right"></i> View detail</a>'].map(function(a){return"<td>"+a+"</td>"}).join()}).map(function(a){return"<tr>"+a+"</tr>"}).join());return Promise.all(c)}).then(function(a){a.forEach(function(a){b("#status_"+a._id).text(a.status);b("#detail_"+
a._id).on("click",function(b){return n(a)})})})},n=function(a){var c=a.config;b("a[class^=detail], p[class^=detail]").text("-");b(".detailRepoName").text(a.repo);b(".detailRepoLink").html('<a target="_blank" href="https://git.trapti.tech/'+a.repo+'"><i class="fa fa-code-fork"></i> '+a.repo);b(".detailBranchLink").html('<a target="_blank" href="https://git.trapti.tech/'+a.repo+"/src/"+a.branch+'">'+a.branch);b(".detailType").text(c.type);b(".detailStatus").text(a.status);b(".detailViewConfig").html('<a target="_blank" href="https://git.trapti.tech/'+
a.repo+"/src/"+a.branch+'/showcase.yaml"><i class="fa fa-wrench"></i> Open showcase.yaml');b(".detailCreated").text((new Date(a.created)).toLocaleString("ja-JP"));b(".detailUpdated").text((new Date(a.updated)).toLocaleString("ja-JP"));b(".detailPrimaryName").html('<a target="_blank" href="http://'+g(a)+'">'+g(a)+"</a>");b(".detailCnames").html(c.cname.length?c.cname.map(function(a){return'<a target="_blank" href="http://'+a+'">'+a+"</a>"}).join("<br>"):"-");b(".detailHttps").text(c.https);b(".detailHttpProxy").text(c.http_proxy?
"80/tcp -> "+c.http_proxy+"/tcp":"-");b(".detailExposedPort").text(h(c.expose));b(".detailInternalAccess").text(c.internal);b(".detailImage").text(c.image);b(".detailWorkDir").text(c.work_dir);b(".detailEntrypoint").text(c.entrypoint);b(".detailStartup").text(c.startup);for(var f in a.keys)for(var d in a.keys[f])b(".detailKey_"+f+"_"+d).text(a.keys[f][d]);b(".detailLog").html(a.logs.reverse().map(function(a,b){return[(new Date(a.created)).toLocaleString("ja-JP"),'<span class="text-'+p[a.status]+'"><i class="fa fa-'+
q[a.status]+'"></i> '+a.status+"</td>",'<a data-index="'+b+'" href="javascript:"><i class="fa fa-chevron-right"></i> View log</a>'].map(function(a){return"<td>"+a+"</td>"}).join()}).map(function(a){return"<tr>"+a+"</tr>"}).join()).find("a").on("click",function(c){return l(a.logs[parseInt(b(c.currentTarget).data("index"))].log)});b("#actionView").off("click").on("click",function(b){return l(a.stdout)});b("#actionDeploy").off("click").on("click",function(b){return e("create",{repo:a.repo,ref:a.branch})});
b("#actionStop").off("click").on("click",function(b){return e("action",{repo:a.repo,ref:a.branch,action:"stop"})});b("#actionStart").off("click").on("click",function(b){return e("action",{repo:a.repo,ref:a.branch,action:"start"})});b("#actionRestart").off("click").on("click",function(b){return e("action",{repo:a.repo,ref:a.branch,action:"restart"})});b("#actionDelete").off("click").on("click",function(b){confirm("Are you sure you want to delete this application "+a.repo+" ("+a.branch+") ?")&&e("remove",
{repo:a.repo,ref:a.branch})});m(".detailRow")},l=function(a){b(".detailLogContent").text(a);m(".logRow")},m=function(a){b(a).slideDown();b(".main-panel").animate({scrollTop:b(a).get(0).offsetTop+"px"})},h=function(a){return a?(Array.isArray(a)?a:[a]).map(function(a){return a+"/tcp"}).join(", "):"-"},g=function(a){var b=a.repo.split("/").reverse().join(".")+".trap.show";return"master"!=a.branch?a.branch+"."+b:b},d=function(a,c){return b.ajax({url:"/api/"+a,data:c,xhrFields:{withCredentials:!0}})},
e=function(a,c){b(".detailRow, .logRow").hide();b("#showcases").html('<tr><th class="process" colspan="8"><i class="fa fa-spinner fa-spin"></i> Processing</th></tr>');d(a,c).then(function(a){return b.notify({message:"OK: "+a},{type:"info"})})["catch"](function(a){return b.notify({message:"NG: "+a.responseText},{type:"danger"})}).then(k)},p={Success:"success",Failed:"danger"},q={Success:"check",Failed:"exclamation"};b(".detailRow, .logRow").hide();b(k)})(jQuery);